
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Upgrading to PyQIR 0.7 &#8212; PyQIR  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Upgrade Guides" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="upgrading-to-pyqir-0-7">
<h1>Upgrading to PyQIR 0.7<a class="headerlink" href="#upgrading-to-pyqir-0-7" title="Permalink to this heading">¶</a></h1>
<section id="packages">
<h2>Packages<a class="headerlink" href="#packages" title="Permalink to this heading">¶</a></h2>
<p>PyQIR 0.6 was the last version of PyQIR to use three packages (<code class="docutils literal notranslate"><span class="pre">pyqir-evaluator</span></code>, <code class="docutils literal notranslate"><span class="pre">pyqir-generator</span></code>, and <code class="docutils literal notranslate"><span class="pre">pyqir-parser</span></code>) and a metapackage (<code class="docutils literal notranslate"><span class="pre">pyqir</span></code>).
PyQIR 0.7 instead uses only a single package (<code class="docutils literal notranslate"><span class="pre">pyqir</span></code>) that has the functionality of all previous packages.</p>
<p>If you imported the <code class="docutils literal notranslate"><span class="pre">pyqir.generator</span></code> or <code class="docutils literal notranslate"><span class="pre">pyqir.parser</span></code> modules, then the same or an equivalent API is available in the <code class="docutils literal notranslate"><span class="pre">pyqir</span></code> module.
If you imported the <code class="docutils literal notranslate"><span class="pre">pyqir.evaluator</span></code> module, it is still available under the same name with no API changes.</p>
</section>
<section id="generator">
<h2>Generator<a class="headerlink" href="#generator" title="Permalink to this heading">¶</a></h2>
<section id="ir-and-bitcode-conversion">
<h3>IR and bitcode conversion<a class="headerlink" href="#ir-and-bitcode-conversion" title="Permalink to this heading">¶</a></h3>
<p>The functions <code class="docutils literal notranslate"><span class="pre">bitcode_to_ir</span></code> and <code class="docutils literal notranslate"><span class="pre">ir_to_bitcode</span></code> were removed because the new <code class="docutils literal notranslate"><span class="pre">Module</span></code> class has the same functionality.
<code class="docutils literal notranslate"><span class="pre">Module</span></code> supports both parsing and generating QIR.
For example, instead of:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqir.generator</span> <span class="kn">import</span> <span class="n">bitcode_to_ir</span><span class="p">,</span> <span class="n">ir_to_bitcode</span>

<span class="n">ir</span> <span class="o">=</span> <span class="n">bitcode_to_ir</span><span class="p">(</span><span class="n">bitcode</span><span class="p">,</span> <span class="s2">&quot;module_name&quot;</span><span class="p">)</span>
<span class="n">bitcode</span> <span class="o">=</span> <span class="n">ir_to_bitcode</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="s2">&quot;module_name&quot;</span><span class="p">)</span>

<span class="c1"># Or with a source filename:</span>
<span class="n">ir</span> <span class="o">=</span> <span class="n">bitcode_to_ir</span><span class="p">(</span><span class="n">bitcode</span><span class="p">,</span> <span class="s2">&quot;module_name&quot;</span><span class="p">,</span> <span class="s2">&quot;source_filename&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Use this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqir</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Module</span>

<span class="n">ir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Module</span><span class="o">.</span><span class="n">from_bitcode</span><span class="p">(</span><span class="n">Context</span><span class="p">(),</span> <span class="n">bitcode</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">))</span>
<span class="n">bitcode</span> <span class="o">=</span> <span class="n">Module</span><span class="o">.</span><span class="n">from_ir</span><span class="p">(</span><span class="n">Context</span><span class="p">(),</span> <span class="n">ir</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bitcode</span>

<span class="c1"># Or with a source filename:</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="o">.</span><span class="n">from_bitcode</span><span class="p">(</span><span class="n">Context</span><span class="p">(),</span> <span class="n">bitcode</span><span class="p">,</span> <span class="s2">&quot;module_name&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">source_filename</span> <span class="o">=</span> <span class="s2">&quot;source_filename&quot;</span>
<span class="n">ir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this heading">¶</a></h3>
<p>If you generated programs with externally-linked functions, then you used the <code class="docutils literal notranslate"><span class="pre">pyqir.generator.types</span></code> module to describe the type of the functions.
This module has been removed.
Types need to be created differently because they now directly contain LLVM type objects, which require an LLVM context.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>PyQIR 0.6</p></th>
<th class="head"><p>PyQIR 0.7</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.VOID</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.Type.void(context)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.BOOL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.IntType(context,</span> <span class="pre">1)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.Int(width)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.IntType(context,</span> <span class="pre">width)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.DOUBLE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.Type.double(context)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.QUBIT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.qubit_type(context)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.RESULT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.result_type(context)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pyqir.generator.types.Function(params,</span> <span class="pre">ret)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pyqir.FunctionType(ret,</span> <span class="pre">params)</span></code></p></td>
</tr>
</tbody>
</table>
<p>There are two ways to get a <code class="docutils literal notranslate"><span class="pre">context</span></code> object:</p>
<ol class="arabic">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">context</span></code> property on <code class="docutils literal notranslate"><span class="pre">SimpleModule</span></code>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqir</span> <span class="kn">import</span> <span class="n">SimpleModule</span><span class="p">,</span> <span class="n">Type</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">SimpleModule</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">num_qubits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">void</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">void</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Create one yourself.
But you also need to give the context you created to <code class="docutils literal notranslate"><span class="pre">SimpleModule</span></code>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyqir</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">SimpleModule</span><span class="p">,</span> <span class="n">Type</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">SimpleModule</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">num_qubits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="n">void</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">void</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="parser">
<h2>Parser<a class="headerlink" href="#parser" title="Permalink to this heading">¶</a></h2>
<p>PyQIR 0.7 unified parsing and code generation into a single API that is designed to support both.
This makes PyQIR much more powerful and will enable workflows that involve inspecting, running passes on, or otherwise transforming QIR that is parsed or generated using PyQIR.
This means that the API for <code class="docutils literal notranslate"><span class="pre">pyqir-parser</span></code> had to be completely redesigned, which unfortunately makes upgrading challenging.
Here are some tips.</p>
<section id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Permalink to this heading">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">Module.from_bitcode</span></code> or <code class="docutils literal notranslate"><span class="pre">Module.from_ir</span></code> instead of the <code class="docutils literal notranslate"><span class="pre">QirModule</span></code> constructor.
See <a class="reference internal" href="#ir-and-bitcode-conversion"><span class="std std-doc">IR and bitcode conversion</span></a>.</p>
</section>
<section id="entry-points-and-interop-friendly-functions">
<h3>Entry points and interop-friendly functions<a class="headerlink" href="#entry-points-and-interop-friendly-functions" title="Permalink to this heading">¶</a></h3>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">QirModule.entrypoint_funcs</span></code>, <code class="docutils literal notranslate"><span class="pre">QirModule.interop_funcs</span></code>, or <code class="docutils literal notranslate"><span class="pre">QirModule.get_funcs_by_attr</span></code>, filter the <code class="docutils literal notranslate"><span class="pre">Module.functions</span></code> list instead.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_point</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">pyqir</span><span class="o">.</span><span class="n">is_entry_point</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">functions</span><span class="p">))</span>
<span class="n">interops</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">pyqir</span><span class="o">.</span><span class="n">is_interop_friendly</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="instructions">
<h3>Instructions<a class="headerlink" href="#instructions" title="Permalink to this heading">¶</a></h3>
<p>The instruction class hierarchy was trimmed down significantly.
Most subclasses of <code class="docutils literal notranslate"><span class="pre">QirInstr</span></code> were removed.
The surviving subclasses are <code class="docutils literal notranslate"><span class="pre">Call</span></code>, <code class="docutils literal notranslate"><span class="pre">FCmp</span></code>, <code class="docutils literal notranslate"><span class="pre">ICmp</span></code>, <code class="docutils literal notranslate"><span class="pre">Phi</span></code> and <code class="docutils literal notranslate"><span class="pre">Switch</span></code>.</p>
<p>For any other instruction, it should be possible to use the base <code class="docutils literal notranslate"><span class="pre">Instruction</span></code> class to do anything that was previously possible.
Use the <code class="docutils literal notranslate"><span class="pre">opcode</span></code> property to check what kind of instruction it is, and the <code class="docutils literal notranslate"><span class="pre">operands</span></code> property to read all of the values that the instruction references.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">successors</span></code> property is a subset of <code class="docutils literal notranslate"><span class="pre">operands</span></code> and contains just the values that are basic blocks, which can be useful to follow control flow with <code class="docutils literal notranslate"><span class="pre">br</span></code> instructions.
For example, if you have a terminator instruction <code class="docutils literal notranslate"><span class="pre">term</span></code>, then you can get the instructions of its first successor with <code class="docutils literal notranslate"><span class="pre">term.successors[0].instructions</span></code>.</p>
</section>
<section id="qubit-and-result-ids">
<h3>Qubit and result IDs<a class="headerlink" href="#qubit-and-result-ids" title="Permalink to this heading">¶</a></h3>
<p>In PyQIR 0.6, <code class="docutils literal notranslate"><span class="pre">QirQubitConstant</span></code> and <code class="docutils literal notranslate"><span class="pre">QirResultConstant</span></code> were subclasses of <code class="docutils literal notranslate"><span class="pre">QirOperand</span></code>.
Instead, you can try to extract a static qubit or result ID from any value using <code class="docutils literal notranslate"><span class="pre">pyqir.qubit_id(value)</span></code> and <code class="docutils literal notranslate"><span class="pre">pyqir.result_id(value)</span></code>.
If the value isn’t the right kind, it will return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</section>
<section id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Permalink to this heading">¶</a></h3>
<p>In PyQIR 0.6, you could read a global string constant from a string value using <code class="docutils literal notranslate"><span class="pre">QirModule.get_global_bytes_value(value)</span></code>.
This is possible now using <code class="docutils literal notranslate"><span class="pre">pyqir.extract_byte_string(value)</span></code>.</p>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h3>
<p>To see examples of how the new parser API can be used, take a look at <a class="reference external" href="https://github.com/qir-alliance/pyqir/blob/53e4aebfdb456e9603fae28543a8391075021a9f/pyqir/tests/test_parser.py">test_parser.py</a>.
You can also compare it with <a class="reference external" href="https://github.com/qir-alliance/pyqir/blob/v0.6.2/pyqir-parser/tests/test_parser_api.py">test_parser_api.py</a> from PyQIR 0.6 for a before-and-after view of the same test cases using both the old and new APIs.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">PyQIR</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development-guide/index.html">Development Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Upgrade Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Upgrading to PyQIR 0.7</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Upgrade Guides</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Upgrade Guides</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021-2022 QIR Alliance.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/upgrade/0.7.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>